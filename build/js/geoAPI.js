var h=(S,i,t)=>new Promise((o,s)=>{var r=e=>{try{a(t.next(e))}catch(l){s(l)}},n=e=>{try{a(t.throw(e))}catch(l){s(l)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,n);a((t=t.apply(S,i)).next())});import b from"./connectToNasa.js";import{localStore as m}from"./localStorage.js";import{getStore as y}from"./localStorage.js";import C from"./fireballs.js";let k=new b;export default class w{init(){return h(this,null,function*(){this.forwardGeo="http://api.positionstack.com/v1/forward?access_key=",this.reverseGeo="http://api.positionstack.com/v1/reverse?access_key=",this.positionstackKey="0f450b6879124d364586219d30b6bb14",this.query="&query=",this.dmtoken="QBxCMLC6DVxM9Lkc0uYokC8ZbxU9P",this.gToken="AIzaSyCmaff4C42bJbYWUp74S_yc4oWWwOkwZog",this.origin="7509 S 2840 W, West Jordan, UT 84084, USA",this.destination="1904 152 ave, Edmonton T5Y 2R7, AB, Canada",this.dmtoken="QBxCMLC6DVxM9Lkc0uYokC8ZbxU9P",this.origin="7509 S 2840 W, West Jordan, UT 84084, USA",this.destination="1904 152 ave, Edmonton T5Y 2R7, AB, Canada",this.fireballs=yield k.getData(),this.tenClosestFireballs=[],this.fbLatLongStore="FBallStore",this.userAddressStore="userLocation",this.userLatLonStore="userLatLon",this.closestFBStore="closestFBs"})}forwardPGet(i,t,o,s,r){return h(this,null,function*(){const n=this.forwardGeo+this.positionstackKey+this.query+`${t},${o} ${s},${r}`;yield fetch(n).then(function(a){return a.json()}).then(function(a){const e=a.data;localStorage.setItem(i,`${e[0].latitude}, ${e[0].longitude}`)})})}reversePGet(i,t){return h(this,null,function*(){const o=this.reverseGeo+this.positionstackKey+this.query+`${i},${t}`;yield fetch(o).then(s=>h(this,null,function*(){return s.json()})).then(function(s){let r=s.data[0].label;return r})})}distanceGet(i,t){return h(this,null,function*(){i=i.split(","),t=t.split(",");function o(L,d){return d=Math.pow(10,d),Math.ceil(L*d)/d}let s=i[0],r=i[1],n=t[0],a=t[1],e=Math.cos,l=Math.asin,c=Math.sqrt,f=6371,u=.017453292519943295,g=.5-e((n-s)*u)/2+e(s*u)*e(n*u)*(1-e((a-r)*u))/2,p=2*f*l(c(g));return p=o(p,0),p})}getTheDistance(){return h(this,null,function*(){let i=y(this.userAddressStore),t=JSON.parse(i);yield this.forwardPGet(this.userLatLonStore,t.ul0,t.ul1,t.ul2,t.ul3),t=JSON.stringify(t);let o=this.fireballs;if(localStorage.getItem(this.fbLatLongStore))o=localStorage.getItem(this.fbLatLongStore);else for(let l=0;l<o.length;l++){let c=o[l].split(",");m(this.fbLatLongStore,`fb${l}`,[c[0],c[1]])}let s=localStorage.getItem(this.userLatLonStore),r=s.split(","),n=r[0],a=r[1];this.tenClosestFireballs=this.getClosest(`${n}, ${a}'`),localStorage.setItem(this.closestFBStore,this.tenClosestFireballs);let e=new C;e.fireballCard()})}getClosest(i){let t=99999999999999,o=[],s=i.split(","),r="";for(let n=0;n<4;n++)this.fireballs.map(a=>{if(o.includes(a))return!1;{let e=a.split(","),l=parseFloat(e[0])-parseFloat(s[0]),c=parseFloat(e[1])-parseFloat(s[1]);l<0&&(l=l*-1),c<0&&(c=c*-1);let f=l+c;f<t&&(t=f,r=a)}}),t=99999999999999,o.push(r);return o}}
